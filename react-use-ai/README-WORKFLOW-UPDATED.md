# 多步骤工作流设计器 - 更新版

基于您的反馈，我已经重新设计了工作流步骤配置，使其更贴近实际的文件处理工作流程。

## 🔄 更新的工作流程

每个步骤现在按照以下三个阶段进行配置：

### 1. 📁 文件输入配置
- **输入所有文件的文件路径并命名**
- 为每个文件设置一个易识别的名称
- 可以直接输入文件路径，或引用前置步骤的输出文件
- 支持依赖关系：后续步骤可以引用前面步骤的输出作为输入

### 2. 💬 提示词配置  
- **输入提示词，提示词中混合有文件的路径**
- 编写处理指令和提示词内容
- 可以在提示词中引用已配置的文件，使用 `{{文件名}}` 格式
- 支持多个提示词，每个提示词可以引用不同的文件组合

### 3. 📤 输出配置
- **指定输出路径和输出文件名**
- 设置输出文件夹路径
- 可选择性设置输出文件名（默认使用源文件名）
- 指定输出文件类型（如 tsx, json, txt 等）

## 🎯 新的配置界面

### 文件输入区域
```
┌─ 1. 文件输入配置 ─────────────────────────┐
│ 文件 1                                    │
│ ├─ 文件名称: [源代码文件]                 │
│ ├─ 文件路径: [./src/components/App.tsx]  │
│ └─ 或引用步骤输出: [选择依赖步骤]         │
│                                           │
│ 文件 2                                    │
│ ├─ 文件名称: [配置文件]                   │
│ ├─ 文件路径: [./config/settings.json]    │
│ └─ 或引用步骤输出: [选择依赖步骤]         │
└───────────────────────────────────────────┘
```

### 提示词配置区域
```
┌─ 2. 提示词配置 ───────────────────────────┐
│ 提示词 1                                  │
│ ├─ 提示词内容:                            │
│ │   请分析{{源代码文件}}的结构，           │
│ │   并根据{{配置文件}}的设置进行优化       │
│ │                                         │
│ └─ 引用的文件: ☑源代码文件 ☑配置文件     │
│                                           │
│ 提示词 2                                  │
│ ├─ 提示词内容:                            │
│ │   生成基于{{源代码文件}}的测试用例       │
│ │                                         │
│ └─ 引用的文件: ☑源代码文件               │
└───────────────────────────────────────────┘
```

### 输出配置区域
```
┌─ 3. 输出配置 ─────────────────────────────┐
│ 输出文件夹: [./output]                    │
│ 输出文件名: [OptimizedApp] (可选)         │
│ 输出文件类型: [tsx]                       │
└───────────────────────────────────────────┘
```

## 🔗 依赖关系处理

### 步骤间文件依赖
- **前置步骤输出**: 步骤A的输出文件可以作为步骤B的输入文件
- **自动路径解析**: 引用前置步骤时，系统自动解析输出文件路径
- **依赖验证**: 确保被依赖的步骤已经配置了正确的输出

### 提示词中的文件引用
- **动态替换**: 执行时将 `{{文件名}}` 替换为实际的文件路径
- **多文件支持**: 一个提示词可以引用多个文件
- **智能提示**: 界面显示可用的文件引用格式

## 📋 实际使用示例

### 示例：React组件重构工作流

**步骤1: 源码分析**
```
文件输入:
- 原始组件: ./src/components/OldComponent.tsx
- 类型定义: ./src/types/index.ts

提示词:
- 分析{{原始组件}}的结构和功能，参考{{类型定义}}中的接口定义

输出:
- 文件夹: ./analysis
- 文件名: ComponentAnalysis
- 类型: json
```

**步骤2: 组件重构**
```
文件输入:
- 分析结果: [依赖步骤1的输出]
- 原始组件: ./src/components/OldComponent.tsx

提示词:
- 基于{{分析结果}}的建议，重构{{原始组件}}为现代化的React组件

输出:
- 文件夹: ./refactored
- 文件名: NewComponent
- 类型: tsx
```

**步骤3: 测试生成**
```
文件输入:
- 重构组件: [依赖步骤2的输出]

提示词:
- 为{{重构组件}}生成完整的单元测试

输出:
- 文件夹: ./tests
- 文件名: NewComponent.test
- 类型: tsx
```

## 🚀 使用流程

1. **创建工作流**: 在工作流管理页面创建新的工作流
2. **添加步骤**: 点击"添加步骤"开始配置第一个步骤
3. **配置文件输入**: 
   - 为每个输入文件设置名称和路径
   - 或选择依赖前置步骤的输出
4. **编写提示词**: 
   - 输入处理指令
   - 选择要引用的文件
   - 系统会显示引用格式提示
5. **设置输出**: 指定输出位置和文件格式
6. **重复添加**: 继续添加后续步骤，建立依赖关系
7. **执行工作流**: 系统按依赖顺序自动执行所有步骤

## 💡 最佳实践

### 文件命名
- 使用描述性的文件名称，便于在提示词中引用
- 避免使用特殊字符，建议使用中文或英文

### 提示词编写
- 明确指出要处理的文件：`{{文件名}}`
- 描述清楚期望的输出格式和要求
- 可以组合多个文件进行复杂的处理任务

### 依赖设计
- 合理规划步骤顺序，避免不必要的依赖
- 利用并行执行能力，独立的步骤可以同时运行
- 考虑错误处理，关键步骤失败时的影响范围

## 🔧 技术实现

### 数据结构更新
```typescript
interface FileInput {
  id: string;
  name: string;           // 用户定义的文件名称
  path: string;           // 文件路径
  dependsOn?: string;     // 依赖的步骤ID
}

interface PromptInput {
  id: string;
  content: string;        // 提示词内容
  fileReferences: string[]; // 引用的文件ID列表
}

interface WorkflowStep {
  config: {
    fileInputs: FileInput[];
    promptInputs: PromptInput[];
    outputFolder: string;
    outputFileName?: string;
    outputFileType: string;
  };
}
```

### 执行时处理
1. **文件路径解析**: 将依赖步骤的输出路径解析为实际文件路径
2. **提示词替换**: 将 `{{文件名}}` 替换为对应的文件路径
3. **API调用**: 将处理后的数据发送到后端处理服务
4. **结果收集**: 收集处理结果并为后续步骤准备输入

这个更新版本更贴近实际的文件处理工作流程，提供了更直观和实用的配置方式。